---
title: "Untitled"
output: html_document
date: "2026-01-09"
---



```{r}
library(flexdashboard)
library(reticulate)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)

# Force R √† utiliser l'environnement virtuel de ton projet VSCode
# On remonte d'un niveau (..) car ton Rmd est dans 'Partie1' et .venv est au-dessus
use_virtualenv("../.venv", required = TRUE)

# Importation
surf_lib <- import("surf_scrap")

```
```{r}
# 4. Ex√©cuter le scraping
# NETTOYEZ BIEN L'URL : elle doit √™tre une simple cha√Æne de caract√®res
URL <- "https://www.surf-report.com/meteo-surf/lacanau-s1043.html"

CSV_OUT <- "data_surf.csv"

# Appel de la fonction Python
surf_lib$scrape_surf_report(URL, output_csv_path = CSV_OUT)

# 5. Charger les donn√©es pour R
data <- readr::read_csv(CSV_OUT)
```
```{r}
# 3. Pr√©paration des KPIs (Nettoyage des plages de donn√©es)
library(tidyverse)
# 2. Pr√©paration des donn√©es (Nettoyage pour KPIs)
df_clean <- data %>%
  # On s√©pare "5.0 - 7.6" pour calculer la moyenne de la plage
  separate(Waves_size, into = c("w_min", "w_max"), sep = " - ", convert = TRUE, remove = FALSE) %>%
  mutate(
    Wave_Mean = (w_min + w_max) / 2,
    Wind_Speed_Num = as.numeric(gsub("[^0-9.]", "", Wind_speed)),
    # Calcul du Score de Qualit√© (Consigne : <1m wave, <50km/h wind, Nord)
    Is_North = grepl("Nord", Wind_direction),
    Quality_Score = case_when(
      Wave_Mean <= 1.0 & Wind_Speed_Num <= 50 & Is_North ~ 100,
      Wave_Mean <= 2.0 & Wind_Speed_Num <= 60 ~ 60,
      TRUE ~ 30
    ),
    Time_Idx = row_number()
  )

# Identification des moments cl√©s
best_moment <- df_clean %>% arrange(desc(Quality_Score), desc(Wave_Mean)) %>% head(1)
highest_wave <- df_clean %>% arrange(desc(w_max)) %>% head(1)
```

Row
-----------------------------------------------------------------------


### üèÑ Meilleur Moment

```{r}
valueBox(
  value = paste(best_moment$Day, "@", best_moment$Hour),
  caption = "Meilleur moment pour pratiquer",
  icon = "fa-star",
  color = "success"
)

```

Row
-----------------------------------------------------------------------

### üåä Plus haute vague

```{r}
valueBox(
  value = paste(highest_wave$w_max, "m"),
  caption = paste("Pr√©vue le", highest_wave$Day),
  icon = "fa-arrows-alt-v",
  color = "info"
)
```

Row
-----------------------------------------------------------------------

### ‚öì Qualit√© de la mer

```{r}
gauge(best_moment$Quality_Score, min = 0, max = 100, symbol = '%', gaugeSectors(
  success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
))
```

Row
-----------------------------------------------------------------------

### Analyse de la Houle (Taille Moyenne)
```{r}
ggplot(df_clean, aes(x = Time_Idx, y = Wave_Mean)) +
  geom_area(fill = "#0077b6", alpha = 0.3) +
  geom_line(color = "#0077b6", size = 1) +
  theme_minimal() +
  labs(x = "Chronologie des pr√©visions", y = "Taille Moyenne (m)")
```

Row
-----------------------------------------------------------------------

### üå¨Ô∏è √âvolution du Vent (Vitesse)

```{r}
ggplot(df_clean, aes(x = Time_Idx, y = Wind_Speed_Num)) +
  geom_col(fill = "#90e0ef") +
  theme_minimal() +
  labs(x = "Chronologie des pr√©visions", y = "Vitesse (km/h)")
```


Row
-----------------------------------------------------------------------

### üìù Donn√©es D√©taill√©es (S√©lection Client)

```{r}
data %>% 
  select(Day, Hour, Waves_size, Wind_direction) %>% 
  kable()
```

Row
-----------------------------------------------------------------------

### üìù Documentation et M√©thodologie (Bonus)
Ce dashboard automatise la r√©cup√©ration des donn√©es de surf via un script **Python** (requests/BeautifulSoup). 
Les donn√©es sont ensuite trait√©es dans **R** : 
- Les plages de taille de vagues sont converties en moyenne arithm√©tique.
- Le score de qualit√© est calcul√© selon les crit√®res : Vagues < 1m, Vent < 50km/h et direction Nord.
